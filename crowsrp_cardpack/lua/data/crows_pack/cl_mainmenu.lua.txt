local function IsAdmin()
    return CROWS_CONFIG.AdminRanks[LocalPlayer():GetUserGroup()] or LocalPlayer():IsSuperAdmin()
end

local function IsAdmin()
    return LocalPlayer():IsAdmin()
end

local function CreateInventoryTab(parent)
    local scroll = vgui.Create("DScrollPanel", parent)
    scroll:Dock(FILL)

    local grid = vgui.Create("DIconLayout", scroll)
    grid:Dock(FILL)
    grid:SetSpaceY(10)
    grid:SetSpaceX(10)

    for i = 1, 20 do -- Simulated 20 cards
        local card = vgui.Create("DButton", grid)
        card:SetSize(100, 150)
        card:SetText("Card " .. i)
        card.DoClick = function() chat.AddText("You clicked Card " .. i) end
    end

    return scroll
end

local function CreateMarketplaceTab(parent)
    local panel = vgui.Create("DPanel", parent)
    panel:Dock(FILL)

    local label = vgui.Create("DLabel", panel)
    label:SetText("Marketplace Coming Soon!")
    label:SetPos(10, 10)
    label:SizeToContents()

    return panel
end

local function CreateShopTab(parent)
    local panel = vgui.Create("DPanel", parent)
    panel:Dock(FILL)

    local label = vgui.Create("DLabel", panel)
    label:SetText("Shop Coming Soon!")
    label:SetPos(10, 10)
    label:SizeToContents()

    return panel
end

local function CreateAdminTab(parent)
    local panel = vgui.Create("DPanel", parent)
    panel:Dock(FILL)

    local label = vgui.Create("DLabel", panel)
    label:SetText("Admin Panel: Configure Packs")
    label:SetPos(10, 10)
    label:SizeToContents()

    return panel
end

local function CreateMainPanel()
    local frame = vgui.Create("DFrame")
    frame:SetSize(900, 600)
    frame:Center()
    frame:SetTitle("Crows RP - Card System")
    frame:MakePopup()

    local tabs = vgui.Create("DPropertySheet", frame)
    tabs:Dock(FILL)

    tabs:AddSheet("Inventory", CreateInventoryTab(tabs), "icon16/box.png")
    tabs:AddSheet("Marketplace", CreateMarketplaceTab(tabs), "icon16/world.png")
    tabs:AddSheet("Shop", CreateShopTab(tabs), "icon16/cart.png")

    if IsAdmin() then
        tabs:AddSheet("Admin Config", CreateAdminTab(tabs), "icon16/cog.png")
    end
end

net.Receive("CrowsPack_OpenMainGUI", function()
    CreateMainPanel()
end)

if LocalPlayer():IsAdmin() then
    local adminTab = vgui.Create("DPanel", mainSheet)
    adminTab:Dock(FILL)

    BuildExpeditionAdminPanel(adminTab)

    mainSheet:AddSheet("Expeditions", adminTab, "icon16/world.png")
end

function BuildExpeditionAdminPanel(parent)
    local list = vgui.Create("DListView", parent)
    list:Dock(FILL)
    list:AddColumn("Zone ID")
    list:AddColumn("Name")
    list:AddColumn("Type")

    for id, data in pairs(ExpeditionZones or {}) do
        list:AddLine(id, data.name or "Unnamed", data.type or "?")
    end

    local spawnBtn = vgui.Create("DButton", parent)
    spawnBtn:SetText("Spawn Selected Zone at Crosshair")
    spawnBtn:Dock(BOTTOM)

    spawnBtn.DoClick = function()
        local selected = list:GetSelectedLine()
        if not selected then return end
        local line = list:GetLine(selected)
        local zoneID = line:GetValue(1)

        net.Start("gang_admin_spawn_expedition")
        net.WriteString(zoneID)
        net.SendToServer()
    end
end

local tabs = {
    ["Inventory"] = CROWS_TCG_OpenInventoryTab,
    ["Marketplace"] = CROWS_TCG_OpenMarketTab,
    ["Shop"] = CROWS_TCG_OpenShopTab,
}
