local PANEL = {}

function PANEL:Init()
    self:SetSize(120, 180)
    self:SetVisible(true)

    self.rarity = "Common"
    self.cardData = {}
    self.isFlipped = false
    self.flipProgress = 0
    self.nextFlip = CurTime() + math.Rand(0.1, 0.5)

    self.cardBack = Material("crows_pack/card_back_" .. string.lower(self.rarity) .. ".png")
    self.cardFrontColor = Color(30, 30, 30, 255)
end

function PANEL:SetCardInfo(rarity, data)
    self.rarity = rarity
    self.cardData = data
    self.cardBack = Material("crows_pack/card_back_" .. string.lower(rarity) .. ".png")
end

function PANEL:Paint(w, h)
    surface.SetDrawColor(255,255,255,255)

    if not self.isFlipped then
        surface.SetMaterial(self.cardBack)
        surface.DrawTexturedRect(0, 0, w, h)
    else
        draw.RoundedBox(8, 0, 0, w, h, self.cardFrontColor)
        draw.SimpleText(self.cardData.name or "???", "DermaLarge", w/2, h/2 - 30, Color(255,255,255), TEXT_ALIGN_CENTER)
        draw.SimpleText(self.rarity, "DermaDefaultBold", w/2, h/2 + 30, Color(255, 100, 255), TEXT_ALIGN_CENTER)
    end
end

function PANEL:Flip()
    if self.isFlipped then return end
    self:EmitSound("crows_pack/card_flip.wav")
    self.isFlipped = true
end

vgui.Register("CrowsPackCard", PANEL, "DPanel")
