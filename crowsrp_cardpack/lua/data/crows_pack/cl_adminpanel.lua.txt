-- Pack Manager Tab (Replace old version)
local packTab = vgui.Create("DPanel", sheet)
sheet:AddSheet("Pack Manager", packTab, "icon16/package.png")

local packList = vgui.Create("DListView", packTab)
packList:SetSize(300, 400)
packList:SetPos(10, 10)
packList:AddColumn("Pack Name")

for name, data in pairs(CROWS_PACK.Packs or {}) do
    packList:AddLine(name)
end

local editPanel = vgui.Create("DPanel", packTab)
editPanel:SetSize(350, 400)
editPanel:SetPos(320, 10)
editPanel:SetVisible(false)

local selectedPack

packList.OnRowSelected = function(_, id, line)
    selectedPack = line:GetColumnText(1)
    editPanel:SetVisible(true)
    editPanel:Clear()

    local y = 10
    for _, rarity in ipairs({ "Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythical", "Ancient" }) do
        local slider = vgui.Create("DNumSlider", editPanel)
        slider:SetPos(10, y)
        slider:SetSize(330, 30)
        slider:SetText(rarity)
        slider:SetMin(0)
        slider:SetMax(100)
        slider:SetDecimals(1)
        slider:SetValue(CROWS_PACK.Packs[selectedPack].rarityChances[rarity] or 0)
        slider.rarity = rarity
        y = y + 35

        editPanel:Add(slider)
    end

    local saveBtn = vgui.Create("DButton", editPanel)
    saveBtn:SetSize(330, 30)
    saveBtn:SetPos(10, y + 5)
    saveBtn:SetText("ðŸ’¾ Save Rarity Distribution")
    saveBtn.DoClick = function()
        local send = {}
        for _, child in pairs(editPanel:GetChildren()) do
            if IsValid(child) and child:GetClass() == "DNumSlider" then
                send[child.rarity] = child:GetValue()
            end
        end

        net.Start("CrowsPack_Admin_SavePackRarities")
        net.WriteString(selectedPack)
        net.WriteTable(send)
        net.SendToServer()
        chat.AddText(Color(0,255,0), "[CrowsPack] Saved rarity chances for pack: " .. selectedPack)
    end
end
