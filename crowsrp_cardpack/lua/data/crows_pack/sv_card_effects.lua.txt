-- lua/crows_cards/sv_card_effects.lua

hook.Add("EntityTakeDamage", "CrowsTCG_DamageModifier", function(target, dmg)
    if not target:IsPlayer() then return end
    local attacker = dmg:GetAttacker()
    if not attacker:IsPlayer() then return end

    for _, card in ipairs(attacker.CrowsInventory or {}) do
        if card.equipped then
            local boost = card.base_damage or 0
            dmg:ScaleDamage(1 + (boost / 100))
        end
    end
end)

hook.Add("ScalePlayerDamage", "CrowsTCG_ArmorHandler", function(ply, hitgroup, dmginfo)
    for _, card in ipairs(ply.CrowsInventory or {}) do
        if card.equipped then
            local armor = card.armor or 0
            dmginfo:ScaleDamage(1 - (armor / 100))
        end
    end
end)

hook.Add("PlayerDeath", "CrowsTCG_DurabilityDrain", function(victim)
    for _, card in ipairs(victim.CrowsInventory or {}) do
        if card.equipped and card.durability then
            card.durability = card.durability - 1
            if card.durability <= 0 then
                card.equipped = false
                victim:ChatPrint("[CrowsTCG] '" .. (card.name or "Card") .. "' broke from 0 durability.")
            end
        end
    end
end)
