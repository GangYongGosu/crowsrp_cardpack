local playerInventory = {}

net.Receive("CrowsPack_SendInventory", function()
    playerInventory = net.ReadTable()

    local frame = vgui.Create("DFrame")
    frame:SetSize(1000, 600)
    frame:Center()
    frame:SetTitle("Crows RP - Inventory")
    frame:MakePopup()

    local sheet = vgui.Create("DPropertySheet", frame)
    sheet:Dock(FILL)

    -- INVENTORY TAB
    local invTab = vgui.Create("DPanel", sheet)
    invTab:Dock(FILL)
    sheet:AddSheet("Inventory", invTab)

    local scroll = vgui.Create("DScrollPanel", invTab)
    scroll:Dock(FILL)

    for i, card in pairs(playerInventory) do
        local cardPanel = scroll:Add("DPanel")
        cardPanel:Dock(TOP)
        cardPanel:SetTall(90)
        cardPanel:DockMargin(0, 5, 0, 5)

        cardPanel.Paint = function(self, w, h)
            draw.RoundedBox(6, 0, 0, w, h, Color(25, 25, 35, 240))
            draw.SimpleText(card.name .. " [" .. card.rarity .. "]", "Trebuchet24", 10, 10, color_white)
            draw.SimpleText("Durability: " .. card.durability .. " | Armor: " .. card.armor .. " | DMG+: " .. card.damageBoost, "DermaDefault", 10, 35, color_white)
        end

        local equip = vgui.Create("DButton", cardPanel)
        equip:SetText("Equip")
        equip:SetSize(80, 30)
        equip:SetPos(800, 20)
        equip.DoClick = function()
            net.Start("CrowsPack_EquipCard")
            net.WriteUInt(card.id, 32)
            net.SendToServer()
        end
    end

    -- TRADE-UP TAB
    local tradeTab = vgui.Create("DPanel", sheet)
    tradeTab:Dock(FILL)
    sheet:AddSheet("Trade-Up", tradeTab)

    local info = vgui.Create("DLabel", tradeTab)
    info:SetText("Trade 10 of the same rarity to get 1 card of the next rarity.")
    info:Dock(TOP)

    local btn = vgui.Create("DButton", tradeTab)
    btn:SetText("Trade-Up")
    btn:SetSize(200, 40)
    btn:Center()
    btn.DoClick = function()
        net.Start("CrowsPack_TradeUp")
        net.SendToServer()
    end
end)

-- lua/crows_cards/cl_inventory.lua

surface.CreateFont("CROWS_TCG_Inv", {
    font = "Trebuchet24",
    size = 20,
    weight = 500
})

function CROWS_TCG_OpenInventory()
    local frame = vgui.Create("DFrame")
    frame:SetSize(900, 600)
    frame:Center()
    frame:SetTitle("Your Card Inventory")
    frame:MakePopup()

    local scroll = vgui.Create("DScrollPanel", frame)
    scroll:Dock(FILL)

    net.Start("CROWS_TCG_RequestInventory")
    net.SendToServer()

    net.Receive("CROWS_TCG_SendInventory", function()
        local cards = net.ReadTable()

        for i, card in ipairs(cards) do
            local panel = scroll:Add("DPanel")
            panel:SetTall(300)
            panel:Dock(TOP)
            panel:DockMargin(5, 5, 5, 5)
            panel.Paint = function(self, w, h)
                draw.RoundedBox(6, 0, 0, w, h, Color(30, 30, 30, 180))
            end

            panel.Card = card

            panel.PaintOver = function(self, w, h)
                draw.SimpleText(card.name .. " [" .. string.upper(card.rarity) .. "]", "CROWS_TCG_Inv", 300, 30, Color(255, 255, 255))
                draw.SimpleText("Stats: " .. card.statsText, "CROWS_TCG_Inv", 300, 60, Color(200, 200, 200))
                draw.SimpleText(card.isEquipped and "✅ Equipped" or "❌ Not Equipped", "CROWS_TCG_Inv", 300, 90, card.isEquipped and Color(100, 255, 100) or Color(255, 100, 100))
            end

            local equipBtn = vgui.Create("DButton", panel)
            equipBtn:SetSize(120, 30)
            equipBtn:SetPos(300, 130)
            equipBtn:SetText(card.isEquipped and "Unequip" or "Equip")
            equipBtn.DoClick = function()
                net.Start("CROWS_TCG_ToggleEquip")
                net.WriteString(card.uid)
                net.SendToServer()
                surface.PlaySound("buttons/button3.wav")
                frame:Close()
                timer.Simple(0.3, CROWS_TCG_OpenInventory)
            end

            CROWS_TCG_RenderCard(card, 10, 10, 250, 280, false)
        end
    end)
end
