util.AddNetworkString("CrowsPack_OpenMainGUI")

hook.Add("PlayerSay", "CrowsPack_ChatCommand", function(ply, text)
    if string.lower(text) == "!unboxcards" then
        net.Start("CrowsPack_OpenMainGUI")
        net.Send(ply)
        return ""
    end
end)

hook.Add("PlayerSay", "CROWS_TCG_EquipCommands", function(ply, text)
    local args = string.Explode(" ", text)
    local cmd = string.lower(args[1])

    if cmd == "/equipcard" and args[2] then
        local targetName = table.concat(args, " ", 2)
        local success = CROWS_TCG_EquipCardByName(ply, targetName)
        return success and "" or ply:ChatPrint("[TCG] Could not equip card: " .. targetName)
    elseif cmd == "/unequipcard" and args[2] then
        local targetName = table.concat(args, " ", 2)
        local success = CROWS_TCG_UnequipCardByName(ply, targetName)
        return success and "" or ply:ChatPrint("[TCG] Could not unequip card: " .. targetName)
    end
end)

function CROWS_TCG_EquipCardByName(ply, name)
    local inv = CROWS_TCG_GetInventory(ply)
    for _, card in ipairs(inv) do
        if string.find(string.lower(card.name), string.lower(name)) then
            return CROWS_TCG_ToggleCardEquip(ply, card.uid, true)
        end
    end
    return false
end

function CROWS_TCG_UnequipCardByName(ply, name)
    local inv = CROWS_TCG_GetInventory(ply)
    for _, card in ipairs(inv) do
        if string.find(string.lower(card.name), string.lower(name)) and card.isEquipped then
            return CROWS_TCG_ToggleCardEquip(ply, card.uid, false)
        end
    end
    return false
end
