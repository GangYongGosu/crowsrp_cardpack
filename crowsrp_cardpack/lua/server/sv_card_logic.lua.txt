-- lua/crows_cards/sv_card_logic.lua

util.AddNetworkString("CrowsTCG:SendNewCard")

function CrowsTCG:GenerateCard(rarity)
    local stats = CROWS_STAT_WEIGHTS[rarity]
    local card = {
        rarity = rarity,
        durability = math.random(stats.durability[1], stats.durability[2]),
        damage = math.random(stats.damage[1], stats.damage[2]),
        accuracy = math.random(stats.accuracy[1], stats.accuracy[2]),
        firerate = math.random(stats.firerate[1], stats.firerate[2]),
        weight = math.random(stats.weight[1], stats.weight[2]),
        passive = self:GeneratePassiveEffect(rarity),
        rank = self:AssignRank(rarity)
    }

    return card
end

function CrowsTCG:AssignRank(rarity)
    local maxIndex = math.min(rarity + 2, 7)
    return CROWS_STAT_RANKS[math.random(1, maxIndex)]
end

function CrowsTCG:GeneratePassiveEffect(rarity)
    local effects = {
        [CROWS_RARITY.EPIC] = {"Bleed Chance", "Life Steal"},
        [CROWS_RARITY.LEGENDARY] = {"Ignite Enemies", "Chain Lightning"},
        [CROWS_RARITY.MYTHICAL] = {"Summon Demon Crow", "Soul Drain"},
        [CROWS_RARITY.ANCIENT] = {"Time Slow", "God Mode (3s)"}
    }

    local pool = effects[rarity]
    if pool then return pool[math.random(#pool)] end
    return "None"
end
